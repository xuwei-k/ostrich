<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>CommandHandler.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2009 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may
 * not use this file except in compliance with the License. You may obtain
 * a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> com.twitter.ostrich
<span class="keyword">package</span> admin

<span class="keyword">import</span> java.io._
<span class="keyword">import</span> java.lang.management.ManagementFactory
<span class="keyword">import</span> java.util.Date
<span class="keyword">import</span> scala.collection.<span class="delimiter">{</span>JavaConversions, Map<span class="delimiter">}</span>
<span class="keyword">import</span> scala.collection.immutable
<span class="keyword">import</span> com.twitter.conversions.<span title="object com.twitter.conversions.time">time</span>._
<span class="keyword">import</span> com.twitter.json.Json
<span class="keyword">import</span> stats.<span class="delimiter">{</span>StatsListener, Stats, StatsCollection<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class UnknownCommandError extends java.io.IOException with ScalaObject" id="9226">UnknownCommandError</a><span title="ScalaObject" class="delimiter">(</span><a title="String" id="25399">command</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="java.io.IOException">IOException</span><span class="delimiter">(</span><span title="(x$1: Any)java.lang.String" class="string">&quot;Unknown command: &quot;</span> + <a href="#25399" title="String">command</a><span class="delimiter">)</span>

<span class="keyword">sealed</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class Format extends java.lang.Object with ScalaObject" id="9227">Format</a><span title="ScalaObject" class="delimiter">(</span><span class="delimiter">)</span>
<span class="keyword">object</span> <a title="object com.twitter.ostrich.admin.Format" id="9228">Format</a> <span title="ScalaObject" class="delimiter">{</span>
  case <span class="keyword">object</span> <a href="#25417" title="object com.twitter.ostrich.admin.Format.PlainText" id="25425">PlainText</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9227" title="com.twitter.ostrich.admin.Format">Format</a>
  case <span class="keyword">object</span> <a href="#25432" title="object com.twitter.ostrich.admin.Format.Json" id="25440">Json</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9227" title="com.twitter.ostrich.admin.Format">Format</a>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class CommandHandler extends java.lang.Object with ScalaObject" id="9230">CommandHandler</a><span title="ScalaObject" class="delimiter">(</span><a title="com.twitter.ostrich.admin.RuntimeEnvironment" id="23708">runtime</a>: <a href="RuntimeEnvironment.scala.html#9249" title="com.twitter.ostrich.admin.RuntimeEnvironment">RuntimeEnvironment</a>, <a title="com.twitter.ostrich.stats.StatsCollection" id="23709">statsCollection</a>: <a href="StatsCollection.scala.html#9357" title="com.twitter.ostrich.stats.StatsCollection">StatsCollection</a><span class="delimiter">)</span> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(obj: Any)List[String]" id="21755">build</a><span class="delimiter">(</span><a title="Any" id="25445">obj</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <a href="#25445" title="Any">obj</a> <span title="List[String]" class="keyword">match</span> <span class="delimiter">{</span>
      <span title="List[String]" class="keyword">case</span> <a title="scala.collection.Map[_,_]" id="25447">m</a>: <span title="scala.collection.Map[_,_]">Map</span><span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt;
        <a href="#25447" title="scala.collection.Map[_,_]">m</a>.<span title="=&gt; Iterable[_]">keys</span>.<span title="(f: (_) =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Iterable[_],java.lang.String,Iterable[java.lang.String]])Iterable[java.lang.String]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.Iterable.Coll,java.lang.String,Iterable[java.lang.String]]" class="delimiter">{</span> <a href="#25473" title="_">_</a>.<span title="()java.lang.String">toString</span> <span class="delimiter">}</span>.<span title="=&gt; List[java.lang.String]">toList</span>.<span title="(implicit ord: Ordering[java.lang.String])List[java.lang.String]">sorted</span>.<span title="(f: (java.lang.String) =&gt; Traversable[java.lang.String])(implicit bf: scala.collection.generic.CanBuildFrom[List[java.lang.String],java.lang.String,List[String]])List[String]">flatMap</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,java.lang.String,List[java.lang.String]]" class="delimiter">{</span> <a title="java.lang.String" id="26866">k</a> =&gt;
          <span class="keyword">val</span> <a title="Any" id="26867">value</a> = <a href="#25447" title="scala.collection.Map[_,_]">m</a>.<span title="[T0]T0">asInstanceOf</span><span title="(key: Any)Any" class="delimiter">[</span><span title="scala.collection.Map[Any,Any]">Map</span><span class="delimiter">[</span>Any, Any<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">(</span><a href="#26866" title="java.lang.String">k</a><span class="delimiter">)</span>
          <a href="#21755" title="(obj: Any)List[String]">build</a><span class="delimiter">(</span><a href="#26867" title="Any">value</a><span class="delimiter">)</span> <span title="List[java.lang.String]" class="keyword">match</span> <span class="delimiter">{</span>
            <span title="List[java.lang.String]" class="keyword">case</span> <a title="String" id="26902">line</a> :: <span title="object Nil">Nil</span> <span class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#26902" title="String">line</a>.<span title="(x$1: java.lang.CharSequence)Boolean">contains</span><span class="delimiter">(</span><span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><a href="#26866" title="java.lang.String">k</a>.<span title="(x$1: Any)java.lang.String">toString</span> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> + <a href="#26902" title="String">line</a><span class="delimiter">)</span>
            <span title="List[java.lang.String]" class="keyword">case</span> <a title="List[String]" id="26916">list</a> =&gt; <span class="delimiter">(</span><a href="#26866" title="java.lang.String">k</a>.<span title="(x$1: Any)java.lang.String">toString</span> + <span title="java.lang.String(&quot;:&quot;)" class="string">&quot;:&quot;</span><span class="delimiter">)</span> <a href="#26917" title="java.lang.String">::</a> <a href="#26916" title="List[String]">list</a>.<span title="(f: (String) =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],java.lang.String,List[java.lang.String]])List[java.lang.String]">map</span> <span title="(x: java.lang.String)List[java.lang.String]" class="delimiter">{</span> <span title="(x$1: Any)java.lang.String" class="string">&quot;  &quot;</span> + <a href="#26932" title="String">_</a> <span class="delimiter">}</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
      <span title="List[String]" class="keyword">case</span> <a title="Array[_]" id="27210">a</a>: <span title="Array[_]">Array</span><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt;
        <a href="#27210" title="(xs: Array[_])scala.collection.mutable.ArrayOps[_]">a</a>.<span title="(f: (_) =&gt; Traversable[String])(implicit bf: scala.collection.generic.CanBuildFrom[Array[_],String,Array[String]])Array[String]">flatMap</span> <span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">{</span> <a href="#21755" title="(obj: Any)List[String]">build</a><span class="delimiter">(</span><a href="#27584" title="_">_</a><span class="delimiter">)</span> <span class="delimiter">}</span>.<span title="=&gt; List[String]">toList</span>
      <span title="List[String]" class="keyword">case</span> <a title="Seq[_]" id="27970">s</a>: <span title="Seq[_]">Seq</span><span class="delimiter">[</span>_<span class="delimiter">]</span> =&gt;
        <a href="#27970" title="Seq[_]">s</a>.<span title="(f: (_) =&gt; Traversable[String])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[_],String,Seq[String]])Seq[String]">flatMap</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,String,Seq[String]]" class="delimiter">{</span> <a href="#21755" title="(obj: Any)List[String]">build</a><span class="delimiter">(</span><a href="#27984" title="_">_</a><span class="delimiter">)</span> <span class="delimiter">}</span>.<span title="=&gt; List[String]">toList</span>
      <span title="List[String]" class="keyword">case</span> <a title="Double" id="28051">d</a>: <span title="Double">Double</span> =&gt;
        <span title="List[String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#28051" title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double">d</a>.<span title="(x$1: Double)Boolean">longValue</span> == <a href="#28051" title="Double">d</a><span class="delimiter">)</span> <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><a href="#28051" title="implicit scala.Predef.double2Double : (x: Double)java.lang.Double">d</a>.<span title="()Long">longValue</span>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span> <span class="keyword">else</span> <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><a href="#28051" title="Double">d</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>
      <span title="List[java.lang.String]" class="keyword">case</span> <a title="Any" id="28104">x</a> =&gt;
        <span title="(xs: java.lang.String*)List[java.lang.String]">List</span><span class="delimiter">(</span><a href="#28104" title="Any">x</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(obj: Any)String" id="21756">flatten</a><span class="delimiter">(</span><a title="Any" id="28114">obj</a>: <span title="Any">Any</span><span class="delimiter">)</span>: <span title="String">String</span> = <a href="#21755" title="(obj: Any)List[String]">build</a><span class="delimiter">(</span><a href="#28114" title="Any">obj</a><span class="delimiter">)</span>.<span title="(sep: String)String">mkString</span><span title="(x$1: Any)java.lang.String" class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span> + <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>

  <span class="keyword">def</span> <a title="(command: String,parameters: scala.collection.Map[String,String],format: com.twitter.ostrich.admin.Format)String" id="21757">apply</a><span class="delimiter">(</span><a title="String" id="22642">command</a>: <span title="String">String</span>, <a title="scala.collection.Map[String,String]" id="22643">parameters</a>: <span title="scala.collection.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span>, <a title="com.twitter.ostrich.admin.Format" id="22644">format</a>: <a href="#9227" title="com.twitter.ostrich.admin.Format">Format</a><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Any" id="28121">rv</a> = <a href="#21758" title="(command: String,parameters: scala.collection.Map[String,String])Any">handleCommand</a><span class="delimiter">(</span><a href="#22642" title="String">command</a>, <a href="#22643" title="scala.collection.Map[String,String]">parameters</a><span class="delimiter">)</span>
    <a href="#22644" title="com.twitter.ostrich.admin.Format">format</a> <span title="String" class="keyword">match</span> <span class="delimiter">{</span>
      <span title="String" class="keyword">case</span> <a href="#9228" title="object com.twitter.ostrich.admin.Format">Format</a>.<a href="#25425" title="object com.twitter.ostrich.admin.Format.PlainText">PlainText</a> =&gt;
        <a href="#21756" title="(obj: Any)String">flatten</a><span class="delimiter">(</span><a href="#28121" title="Any">rv</a><span class="delimiter">)</span>
      <span title="java.lang.String" class="keyword">case</span> <a href="#9228" title="object com.twitter.ostrich.admin.Format">Format</a>.<a href="#25440" title="object com.twitter.ostrich.admin.Format.Json">Json</a> =&gt;
        <span class="comment">// force it into a map because some json clients expect the top-level object to be a map.</span>
        <span title="object com.twitter.json.Json">Json</span>.<span title="(obj: Any)com.twitter.json.JsonQuoted">build</span><span class="delimiter">(</span><a href="#28121" title="Any">rv</a> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
          <span title="scala.collection.Map[_,_]" class="keyword">case</span> <a title="scala.collection.Map[_,_]" id="28136">x</a>: <span title="scala.collection.Map[_,_]">Map</span><span class="delimiter">[</span>_, _<span class="delimiter">]</span> =&gt; <a href="#28136" title="scala.collection.Map[_,_]">x</a>
          <span title="scala.collection.immutable.Map[java.lang.String,Any]" class="keyword">case</span> _ =&gt; immutable.<span title="(elems: (java.lang.String, Any)*)scala.collection.immutable.Map[java.lang.String,Any]">Map</span><span class="delimiter">(</span><span title="(y: Any)(java.lang.String, Any)" class="string">&quot;response&quot;</span> -&gt; <a href="#28121" title="Any">rv</a><span class="delimiter">)</span>
        <span class="delimiter">}</span><span class="delimiter">)</span>.<span title="(x$1: Any)java.lang.String">toString</span> + <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(command: String,parameters: scala.collection.Map[String,String])Any" id="21758">handleCommand</a><span class="delimiter">(</span><a title="String" id="28122">command</a>: <span title="String">String</span>, <a title="scala.collection.Map[String,String]" id="28123">parameters</a>: <span title="scala.collection.Map[String,String]">Map</span><span class="delimiter">[</span>String, String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Any">Any</span> = <span class="delimiter">{</span>
    <a href="#28122" title="String">command</a> <span title="Any" class="keyword">match</span> <span class="delimiter">{</span>
      <span title="java.lang.String(&quot;pong&quot;)" class="keyword">case</span> <span title="java.lang.String(&quot;ping&quot;)" class="string">&quot;ping&quot;</span> =&gt;
        <span title="java.lang.String(&quot;pong&quot;)" class="string">&quot;pong&quot;</span>
      <span title="java.lang.String" class="keyword">case</span> <span title="java.lang.String(&quot;reload&quot;)" class="string">&quot;reload&quot;</span> =&gt;
        <a href="BackgroundProcess.scala.html#9211" title="object com.twitter.ostrich.admin.BackgroundProcess">BackgroundProcess</a>.<a href="BackgroundProcess.scala.html#24650" title="(threadName: String)(f: =&gt; Unit)java.lang.Thread">spawn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;admin:reload&quot;)" class="string">&quot;admin:reload&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <a href="ServiceTracker.scala.html#9259" title="object com.twitter.ostrich.admin.ServiceTracker">ServiceTracker</a>.<a href="ServiceTracker.scala.html#24625" title="()Unit">reload</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="java.lang.String(&quot;ok&quot;)" class="string">&quot;ok&quot;</span>
      <span title="java.lang.String" class="keyword">case</span> <span title="java.lang.String(&quot;shutdown&quot;)" class="string">&quot;shutdown&quot;</span> =&gt;
        <a href="BackgroundProcess.scala.html#9211" title="object com.twitter.ostrich.admin.BackgroundProcess">BackgroundProcess</a>.<a href="BackgroundProcess.scala.html#24650" title="(threadName: String)(f: =&gt; Unit)java.lang.Thread">spawn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;admin:shutdown&quot;)" class="string">&quot;admin:shutdown&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(100L)" class="int">100</span><span class="delimiter">)</span>
          <a href="ServiceTracker.scala.html#9259" title="object com.twitter.ostrich.admin.ServiceTracker">ServiceTracker</a>.<a href="ServiceTracker.scala.html#24623" title="()Unit">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="java.lang.String(&quot;ok&quot;)" class="string">&quot;ok&quot;</span>
      <span title="java.lang.String" class="keyword">case</span> <span title="java.lang.String(&quot;quiesce&quot;)" class="string">&quot;quiesce&quot;</span> =&gt;
        <a href="BackgroundProcess.scala.html#9211" title="object com.twitter.ostrich.admin.BackgroundProcess">BackgroundProcess</a>.<a href="BackgroundProcess.scala.html#24650" title="(threadName: String)(f: =&gt; Unit)java.lang.Thread">spawn</a><span class="delimiter">(</span><span title="java.lang.String(&quot;admin:quiesce&quot;)" class="string">&quot;admin:quiesce&quot;</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="object java.lang.Thread">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><span class="delimiter">(</span><span title="Long(100L)" class="int">100</span><span class="delimiter">)</span>
          <a href="ServiceTracker.scala.html#9259" title="object com.twitter.ostrich.admin.ServiceTracker">ServiceTracker</a>.<a href="ServiceTracker.scala.html#24624" title="()Unit">quiesce</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span title="java.lang.String(&quot;ok&quot;)" class="string">&quot;ok&quot;</span>
      <span title="scala.collection.Map[String,Any]" class="keyword">case</span> <span title="java.lang.String(&quot;stats&quot;)" class="string">&quot;stats&quot;</span> =&gt;
        <span class="keyword">val</span> <a title="Boolean" id="28219">filtered</a> = <a href="#28123" title="scala.collection.Map[String,String]">parameters</a>.<span title="(key: String)Option[String]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;filtered&quot;)" class="string">&quot;filtered&quot;</span><span class="delimiter">)</span>.<span title="(default: =&gt; String)String">getOrElse</span><span title="(x$1: AnyRef)Boolean" class="delimiter">(</span><span title="java.lang.String(&quot;0&quot;)" class="string">&quot;0&quot;</span><span class="delimiter">)</span> == <span title="java.lang.String(&quot;1&quot;)" class="string">&quot;1&quot;</span>
        <a href="#28123" title="scala.collection.Map[String,String]">parameters</a>.<span title="(key: String)Option[String]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;period&quot;)" class="string">&quot;period&quot;</span><span class="delimiter">)</span>.<span title="(f: (String) =&gt; com.twitter.ostrich.stats.StatsSummary)Option[com.twitter.ostrich.stats.StatsSummary]">map</span> <span class="delimiter">{</span> <a title="String" id="28239">period</a> =&gt;
          <span class="comment">// listener for a given period</span>
          <a href="StatsListener.scala.html#28246" title="(period: com.twitter.util.Duration,collection: com.twitter.ostrich.stats.StatsCollection)com.twitter.ostrich.stats.StatsListener">StatsListener</a><span class="delimiter">(</span><a href="#28239" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">period</a>.<span title="implicit com.twitter.conversions.time.intToTimeableNumber : (i: Int)com.twitter.conversions.time.RichWholeNumber">toInt</span>.<span title="=&gt; com.twitter.util.Duration">seconds</span>, <a href="#23709" title="com.twitter.ostrich.stats.StatsCollection">statsCollection</a><span class="delimiter">)</span>.<a href="StatsListener.scala.html#28588" title="(filtered: Boolean)com.twitter.ostrich.stats.StatsSummary">get</a><span class="delimiter">(</span><a href="#28219" title="Boolean">filtered</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>.<span title="(alternative: =&gt; Option[com.twitter.ostrich.stats.StatsSummary])Option[com.twitter.ostrich.stats.StatsSummary]">orElse</span> <span class="delimiter">{</span>
          <span class="comment">// (archaic, deprecated) named listener</span>
          <a href="#28123" title="scala.collection.Map[String,String]">parameters</a>.<span title="(key: String)Option[String]">get</span><span class="delimiter">(</span><span title="java.lang.String(&quot;namespace&quot;)" class="string">&quot;namespace&quot;</span><span class="delimiter">)</span>.<span title="(f: (String) =&gt; com.twitter.ostrich.stats.StatsSummary)Option[com.twitter.ostrich.stats.StatsSummary]">map</span> <span class="delimiter">{</span> <a title="String" id="28623">namespace</a> =&gt;
            <a href="StatsListener.scala.html#28245" title="(name: String,collection: com.twitter.ostrich.stats.StatsCollection)com.twitter.ostrich.stats.StatsListener">StatsListener</a><span class="delimiter">(</span><a href="#28623" title="String">namespace</a>, <a href="#23709" title="com.twitter.ostrich.stats.StatsCollection">statsCollection</a><span class="delimiter">)</span>.<a href="StatsListener.scala.html#28588" title="(filtered: Boolean)com.twitter.ostrich.stats.StatsSummary">get</a><span class="delimiter">(</span><a href="#28219" title="Boolean">filtered</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>.<span title="(default: =&gt; com.twitter.ostrich.stats.StatsSummary)com.twitter.ostrich.stats.StatsSummary">getOrElse</span> <span class="delimiter">{</span>
          <span class="comment">// raw, un-delta'd data</span>
          <a href="#23709" title="com.twitter.ostrich.stats.StatsCollection">statsCollection</a>.<a href="StatsProvider.scala.html#23984" title="()com.twitter.ostrich.stats.StatsSummary">get</a><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>.<a href="StatsProvider.scala.html#28609" title="=&gt; scala.collection.Map[String,Any]">toMap</a>
      <span title="scala.collection.immutable.Map[java.lang.String,Any]" class="keyword">case</span> <span title="java.lang.String(&quot;server_info&quot;)" class="string">&quot;server_info&quot;</span> =&gt;
        <span class="keyword">val</span> <a title="java.lang.management.RuntimeMXBean" id="28654">mxRuntime</a> = <span title="object java.lang.management.ManagementFactory">ManagementFactory</span>.<span title="()java.lang.management.RuntimeMXBean">getRuntimeMXBean</span><span class="delimiter">(</span><span class="delimiter">)</span>
        immutable.<span title="(elems: (java.lang.String, Any)*)scala.collection.immutable.Map[java.lang.String,Any]">Map</span><span class="delimiter">(</span>
          <span title="(y: java.lang.String)(java.lang.String, java.lang.String)" class="string">&quot;name&quot;</span> -&gt; <a href="#23708" title="com.twitter.ostrich.admin.RuntimeEnvironment">runtime</a>.<a href="RuntimeEnvironment.scala.html#24047" title="=&gt; java.lang.String">jarName</a>,
          <span title="(y: java.lang.String)(java.lang.String, java.lang.String)" class="string">&quot;version&quot;</span> -&gt; <a href="#23708" title="com.twitter.ostrich.admin.RuntimeEnvironment">runtime</a>.<a href="RuntimeEnvironment.scala.html#24049" title="=&gt; java.lang.String">jarVersion</a>,
          <span title="(y: java.lang.String)(java.lang.String, java.lang.String)" class="string">&quot;build&quot;</span> -&gt; <a href="#23708" title="com.twitter.ostrich.admin.RuntimeEnvironment">runtime</a>.<a href="RuntimeEnvironment.scala.html#24051" title="=&gt; java.lang.String">jarBuild</a>,
          <span title="(y: java.lang.String)(java.lang.String, java.lang.String)" class="string">&quot;build_revision&quot;</span> -&gt; <a href="#23708" title="com.twitter.ostrich.admin.RuntimeEnvironment">runtime</a>.<a href="RuntimeEnvironment.scala.html#24053" title="=&gt; java.lang.String">jarBuildRevision</a>,
          <span title="(y: java.lang.String)(java.lang.String, java.lang.String)" class="string">&quot;build_branch_name&quot;</span> -&gt; <a href="#23708" title="com.twitter.ostrich.admin.RuntimeEnvironment">runtime</a>.<a href="RuntimeEnvironment.scala.html#24057" title="=&gt; java.lang.String">jarBuildBranchName</a>,
          <span title="(y: Array[java.lang.String])(java.lang.String, Array[java.lang.String])" class="string">&quot;build_last_few_commits&quot;</span> -&gt; <a href="#23708" title="com.twitter.ostrich.admin.RuntimeEnvironment">runtime</a>.<a href="RuntimeEnvironment.scala.html#24059" title="=&gt; java.lang.String">jarBuildLastFewCommits</a>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span class="delimiter">(</span><span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span><span class="delimiter">)</span>,
          <span title="(y: java.lang.String)(java.lang.String, java.lang.String)" class="string">&quot;start_time&quot;</span> -&gt; <span class="delimiter">(</span><span title="(x$1: Long)java.util.Date" class="keyword">new</span> <span title="java.util.Date">Date</span><span class="delimiter">(</span><a href="#28654" title="java.lang.management.RuntimeMXBean">mxRuntime</a>.<span title="()Long">getStartTime</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="()java.lang.String">toString</span>,
          <span title="(y: Long)(java.lang.String, Long)" class="string">&quot;uptime&quot;</span> -&gt; <a href="#28654" title="java.lang.management.RuntimeMXBean">mxRuntime</a>.<span title="()Long">getUptime</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span class="delimiter">)</span>
      <span title="scala.collection.Map[String,scala.collection.Map[String,scala.collection.Map[String,Any]]]" class="keyword">case</span> <span title="java.lang.String(&quot;threads&quot;)" class="string">&quot;threads&quot;</span> =&gt;
        <a href="#21759" title="()scala.collection.Map[String,scala.collection.Map[String,scala.collection.Map[String,Any]]]">getThreadStacks</a><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="java.lang.String" class="keyword">case</span> <span title="java.lang.String(&quot;gc&quot;)" class="string">&quot;gc&quot;</span> =&gt;
        <span title="object java.lang.System">System</span>.<span title="()Unit">gc</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <span title="java.lang.String(&quot;ok&quot;)" class="string">&quot;ok&quot;</span>
      <span title="Nothing" class="keyword">case</span> <a title="String" id="29417">x</a> =&gt;
        <span title="Nothing" class="keyword">throw</span> <span title="com.twitter.ostrich.admin.UnknownCommandError" class="keyword">new</span> <a href="#9226" title="com.twitter.ostrich.admin.UnknownCommandError">UnknownCommandError</a><span class="delimiter">(</span><a href="#29417" title="String">x</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()scala.collection.Map[String,scala.collection.Map[String,scala.collection.Map[String,Any]]]" id="21759">getThreadStacks</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="scala.collection.Map[String,scala.collection.Map[String,scala.collection.Map[String,Any]]]">Map</span><span class="delimiter">[</span>String, Map<span class="delimiter">[</span>String, Map<span class="delimiter">[</span>String, Any<span class="delimiter">]</span><span class="delimiter">]</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="Seq[(java.lang.String, scala.collection.immutable.Map[java.lang.String,Any])]" id="29419">stacks</a> = <span title="object scala.collection.JavaConversions">JavaConversions</span>.<span title="(m: java.util.Map[java.lang.Thread,Array[java.lang.StackTraceElement]])scala.collection.mutable.Map[java.lang.Thread,Array[java.lang.StackTraceElement]]">asScalaMap</span><span class="delimiter">(</span><span title="object java.lang.Thread">Thread</span>.<span title="()java.util.Map[java.lang.Thread,Array[java.lang.StackTraceElement]]">getAllStackTraces</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>.<span title="(f: ((java.lang.Thread, Array[java.lang.StackTraceElement])) =&gt; (java.lang.String, scala.collection.immutable.Map[java.lang.String,Any]))(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.Map[java.lang.Thread,Array[java.lang.StackTraceElement]],(java.lang.String, scala.collection.immutable.Map[java.lang.String,Any]),scala.collection.mutable.Map[java.lang.String,scala.collection.immutable.Map[java.lang.String,Any]]])scala.collection.mutable.Map[java.lang.String,scala.collection.immutable.Map[java.lang.String,Any]]">map</span> <a href="#30499" title="(java.lang.String, scala.collection.immutable.Map[java.lang.String,Any])" class="delimiter">{</a> <span title="(java.lang.String, scala.collection.immutable.Map[java.lang.String,Any])" class="keyword">case</span> <span class="delimiter">(</span><a title="java.lang.Thread" id="30502">thread</a>, <a title="Array[java.lang.StackTraceElement]" id="30503">stack</a><span class="delimiter">)</span> =&gt;
      <span title="(_1: java.lang.String,_2: scala.collection.immutable.Map[java.lang.String,Any])(java.lang.String, scala.collection.immutable.Map[java.lang.String,Any])" class="delimiter">(</span><a href="#30502" title="java.lang.Thread">thread</a>.<span title="()Long">getId</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.lang.String">toString</span>, immutable.<span title="(elems: (java.lang.String, Any)*)scala.collection.immutable.Map[java.lang.String,Any]">Map</span><span class="delimiter">(</span><span title="(y: java.lang.String)(java.lang.String, java.lang.String)" class="string">&quot;thread&quot;</span> -&gt; <a href="#30502" title="java.lang.Thread">thread</a>.<span title="()java.lang.String">getName</span><span class="delimiter">(</span><span class="delimiter">)</span>,
                                              <span title="(y: Boolean)(java.lang.String, Boolean)" class="string">&quot;daemon&quot;</span> -&gt; <a href="#30502" title="java.lang.Thread">thread</a>.<span title="()Boolean">isDaemon</span><span class="delimiter">(</span><span class="delimiter">)</span>,
                                              <span title="(y: java.lang.Thread.State)(java.lang.String, java.lang.Thread.State)" class="string">&quot;state&quot;</span> -&gt; <a href="#30502" title="java.lang.Thread">thread</a>.<span title="()java.lang.Thread.State">getState</span><span class="delimiter">(</span><span class="delimiter">)</span>,
                                              <span title="(y: Int)(java.lang.String, Int)" class="string">&quot;priority&quot;</span> -&gt; <a href="#30502" title="java.lang.Thread">thread</a>.<span title="()Int">getPriority</span><span class="delimiter">(</span><span class="delimiter">)</span>,
                                              <span title="(y: Seq[java.lang.String])(java.lang.String, Seq[java.lang.String])" class="string">&quot;stack&quot;</span> -&gt; <a href="#30503" title="(xs: Array[java.lang.StackTraceElement])scala.collection.mutable.ArrayOps[java.lang.StackTraceElement]">stack</a>.<span title="=&gt; Seq[java.lang.StackTraceElement]">toSeq</span>.<span title="(f: (java.lang.StackTraceElement) =&gt; java.lang.String)(implicit bf: scala.collection.generic.CanBuildFrom[Seq[java.lang.StackTraceElement],java.lang.String,Seq[java.lang.String]])Seq[java.lang.String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.Seq.Coll,java.lang.String,Seq[java.lang.String]]" class="delimiter">(</span><a href="#30959" title="java.lang.StackTraceElement">_</a>.<span title="()java.lang.String">toString</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>.<span title="=&gt; Seq[(java.lang.String, scala.collection.immutable.Map[java.lang.String,Any])]">toSeq</span>
    immutable.<span title="(elems: (java.lang.String, scala.collection.immutable.Map[java.lang.String,scala.collection.immutable.Map[java.lang.String,Any]])*)scala.collection.immutable.Map[java.lang.String,scala.collection.immutable.Map[java.lang.String,scala.collection.immutable.Map[java.lang.String,Any]]]">Map</span><span class="delimiter">(</span><span title="(y: scala.collection.immutable.Map[java.lang.String,scala.collection.immutable.Map[java.lang.String,Any]])(java.lang.String, scala.collection.immutable.Map[java.lang.String,scala.collection.immutable.Map[java.lang.String,Any]])" class="string">&quot;threads&quot;</span> -&gt; immutable.<span title="(elems: (java.lang.String, scala.collection.immutable.Map[java.lang.String,Any])*)scala.collection.immutable.Map[java.lang.String,scala.collection.immutable.Map[java.lang.String,Any]]">Map</span><span class="delimiter">(</span><a href="#29419" title="Seq[(java.lang.String, scala.collection.immutable.Map[java.lang.String,Any])]">stacks</a>: _*<span class="delimiter">)</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>