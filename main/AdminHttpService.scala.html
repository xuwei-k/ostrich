<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>AdminHttpService.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/*
 * Copyright 2009 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may
 * not use this file except in compliance with the License. You may obtain
 * a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="keyword">package</span> com.twitter.ostrich
<span class="keyword">package</span> admin

<span class="keyword">import</span> java.io.<span class="delimiter">{</span>InputStream, OutputStream<span class="delimiter">}</span>
<span class="keyword">import</span> java.net.<span class="delimiter">{</span>InetSocketAddress, Socket, URI<span class="delimiter">}</span>
<span class="keyword">import</span> scala.io.Source
<span class="keyword">import</span> com.sun.net.httpserver.<span class="delimiter">{</span>HttpExchange, HttpHandler, HttpServer<span class="delimiter">}</span>
<span class="keyword">import</span> com.twitter.conversions.<span title="object com.twitter.conversions.time">time</span>._
<span class="keyword">import</span> com.twitter.logging.Logger
<span class="keyword">import</span> com.twitter.util.<span class="delimiter">{</span>Duration, Time<span class="delimiter">}</span>
<span class="keyword">import</span> java.util.Properties
<span class="keyword">import</span> stats.<span class="delimiter">{</span>StatsCollection, Stats<span class="delimiter">}</span>

<span class="comment">/**
 * Custom handler interface for the admin web site. The standard `render` calls are implemented in
 * terms of a single `handle` call. For more functionality, check out subclasses like
 * `FolderResourceHandler` and `CgiRequestHandler`.
 */</span>
<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class CustomHttpHandler extends java.lang.Object with com.sun.net.httpserver.HttpHandler with ScalaObject" id="9194">CustomHttpHandler</a> <span title="ScalaObject" class="keyword">extends</span> <span title="com.sun.net.httpserver.HttpHandler">HttpHandler</span> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="com.twitter.logging.Logger" id="11213">log</a> = <span title="object com.twitter.logging.Logger">Logger</span>.<span title="(cls: Class[_])com.twitter.logging.Logger">get</span><span class="delimiter">(</span><a href="#9194" title="()java.lang.Class[_]">getClass</a><span class="delimiter">)</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="java.util.Properties" id="11215">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <a href="#11215" title="=&gt; java.util.Properties">properties</a>.<span title="(x$1: java.io.InputStream)Unit">load</span><span class="delimiter">(</span><a href="#9194" title="()java.lang.Class[_]">getClass</a>.<span title="(x$1: java.lang.String)java.io.InputStream">getResourceAsStream</span><span class="delimiter">(</span><span title="java.lang.String(&quot;/ostrich.properties&quot;)" class="string">&quot;/ostrich.properties&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(body: String,exchange: com.sun.net.httpserver.HttpExchange)Unit" id="11217">render</a><span class="delimiter">(</span><a title="String" id="17057">body</a>: <span title="String">String</span>, <a title="com.sun.net.httpserver.HttpExchange" id="17058">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#11218" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange,code: Int)Unit">render</a><span class="delimiter">(</span><a href="#17057" title="String">body</a>, <a href="#17058" title="com.sun.net.httpserver.HttpExchange">exchange</a>, <span title="Int(200)" class="int">200</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(body: String,exchange: com.sun.net.httpserver.HttpExchange,code: Int)Unit" id="11218">render</a><span class="delimiter">(</span><a title="String" id="17093">body</a>: <span title="String">String</span>, <a title="com.sun.net.httpserver.HttpExchange" id="17094">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span>, <a title="Int" id="17095">code</a>: <span title="Int">Int</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#11219" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange,code: Int,contentType: String)Unit">render</a><span class="delimiter">(</span><a href="#17093" title="String">body</a>, <a href="#17094" title="com.sun.net.httpserver.HttpExchange">exchange</a>, <a href="#17095" title="Int">code</a>, <span title="java.lang.String(&quot;text/html&quot;)" class="string">&quot;text/html&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(body: String,exchange: com.sun.net.httpserver.HttpExchange,code: Int,contentType: String)Unit" id="11219">render</a><span class="delimiter">(</span><a title="String" id="17088">body</a>: <span title="String">String</span>, <a title="com.sun.net.httpserver.HttpExchange" id="17089">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span>, <a title="Int" id="17090">code</a>: <span title="Int">Int</span>, <a title="String" id="17091">contentType</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.InputStream" id="17102">input</a>: <span title="java.io.InputStream">InputStream</span> = <a href="#17089" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()java.io.InputStream">getRequestBody</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.OutputStream" id="17103">output</a>: <span title="java.io.OutputStream">OutputStream</span> = <a href="#17089" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()java.io.OutputStream">getResponseBody</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#17089" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()com.sun.net.httpserver.Headers">getResponseHeaders</span>.<span title="(x$1: java.lang.String,x$2: java.lang.String)Unit">set</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Content-Type&quot;)" class="string">&quot;Content-Type&quot;</span>, <a href="#17091" title="String">contentType</a><span class="delimiter">)</span>
    <a href="#17089" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()com.sun.net.httpserver.Headers">getResponseHeaders</span>.<span title="(x$1: java.lang.String,x$2: java.lang.String)Unit">set</span><span class="delimiter">(</span><span title="java.lang.String(&quot;X-Ostrich-Version&quot;)" class="string">&quot;X-Ostrich-Version&quot;</span>, <a href="#11215" title="=&gt; java.util.Properties">properties</a>.<span title="(x$1: java.lang.String)java.lang.String">getProperty</span><span class="delimiter">(</span><span title="java.lang.String(&quot;version&quot;)" class="string">&quot;version&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[Byte]" id="17104">data</a> = <a href="#17088" title="String">body</a>.<span title="()Array[Byte]">getBytes</span>
    <a href="#17089" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="(x$1: Int,x$2: Long)Unit">sendResponseHeaders</span><span class="delimiter">(</span><a href="#17090" title="Int">code</a>, <a href="#17104" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">data</a>.<span title="=&gt; Long">size</span><span class="delimiter">)</span>
    <a href="#17103" title="java.io.OutputStream">output</a>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#17104" title="Array[Byte]">data</a><span class="delimiter">)</span>
    <a href="#17103" title="java.io.OutputStream">output</a>.<span title="()Unit">flush</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#17103" title="java.io.OutputStream">output</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#17089" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(name: String)String" id="11220">loadResource</a><span class="delimiter">(</span><a title="String" id="17640">name</a>: <span title="String">String</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <a href="#11213" title="=&gt; com.twitter.logging.Logger">log</a>.<span title="(msg: String,items: Any*)Unit">debug</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Loading resource from file: %s&quot;)" class="string">&quot;Loading resource from file: %s&quot;</span>, <a href="#17640" title="String">name</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.InputStream" id="17643">stream</a> = <a href="#9194" title="()java.lang.Class[_]">getClass</a>.<span title="(x$1: java.lang.String)java.io.InputStream">getResourceAsStream</span><span class="delimiter">(</span><a href="#17640" title="String">name</a><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span title="object scala.io.Source">Source</span>.<span title="(is: java.io.InputStream)(implicit codec: scala.io.Codec)scala.io.BufferedSource">fromInputStream</span><span title="=&gt; scala.io.Codec" class="delimiter">(</span><a href="#17643" title="java.io.InputStream">stream</a><span class="delimiter">)</span>.<span title="=&gt; String">mkString</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span title="Nothing" class="keyword">case</span> <a title="java.lang.Throwable" id="18131">e</a> =&gt;
        <a href="#11213" title="=&gt; com.twitter.logging.Logger">log</a>.<span title="(thrown: Throwable,msg: String,items: Any*)Unit">error</span><span class="delimiter">(</span><a href="#18131" title="java.lang.Throwable">e</a>, <span title="java.lang.String(&quot;Unable to load Resource from Classpath: %s&quot;)" class="string">&quot;Unable to load Resource from Classpath: %s&quot;</span>, <a href="#17640" title="String">name</a><span class="delimiter">)</span>
        <span title="Nothing" class="keyword">throw</span> <a href="#18131" title="java.lang.Throwable">e</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(exchange: com.sun.net.httpserver.HttpExchange)Unit" id="11221">handle</a><span class="delimiter">(</span><a title="com.sun.net.httpserver.HttpExchange" id="18137">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span><span class="delimiter">)</span>: <span title="Unit">Unit</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class MissingFileHandler extends com.twitter.ostrich.admin.CustomHttpHandler with ScalaObject" id="9195">MissingFileHandler</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9194" title="com.twitter.ostrich.admin.CustomHttpHandler">CustomHttpHandler</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(exchange: com.sun.net.httpserver.HttpExchange)Unit" id="18140">handle</a><span class="delimiter">(</span><a title="com.sun.net.httpserver.HttpExchange" id="18143">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#11218" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange,code: Int)Unit">render</a><span class="delimiter">(</span><span title="java.lang.String(&quot;no such file&quot;)" class="string">&quot;no such file&quot;</span>, <a href="#18143" title="com.sun.net.httpserver.HttpExchange">exchange</a>, <span title="Int(404)" class="int">404</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class PageResourceHandler extends com.twitter.ostrich.admin.CustomHttpHandler with ScalaObject" id="9196">PageResourceHandler</a><span title="ScalaObject" class="delimiter">(</span><a title="String" id="18158">path</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#9194" title="com.twitter.ostrich.admin.CustomHttpHandler">CustomHttpHandler</a> <span class="delimiter">{</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="String" id="18153">page</a> = <a href="#11220" title="(name: String)String">loadResource</a><span class="delimiter">(</span><a href="#18158" title="String">path</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(exchange: com.sun.net.httpserver.HttpExchange)Unit" id="18154">handle</a><span class="delimiter">(</span><a title="com.sun.net.httpserver.HttpExchange" id="18160">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="#11217" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange)Unit">render</a><span class="delimiter">(</span><a href="#18152" title="=&gt; String">page</a>, <a href="#18160" title="com.sun.net.httpserver.HttpExchange">exchange</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="comment">/**
 * Serve static pages as java resources.
 */</span>
<span class="keyword">class</span> <a title="class FolderResourceHandler extends com.twitter.ostrich.admin.CustomHttpHandler with ScalaObject" id="9197">FolderResourceHandler</a><span title="ScalaObject" class="delimiter">(</span><a title="String" id="18174">staticPath</a>: <span title="String">String</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#9194" title="com.twitter.ostrich.admin.CustomHttpHandler">CustomHttpHandler</a> <span class="delimiter">{</span>
  <span class="comment">/**
   * Given a requestPath (e.g. /static/digraph.js), break it up into the path and filename
   */</span>
  <span class="keyword">def</span> <a title="(requestPath: String)String" id="18169">getRelativePath</a><span class="delimiter">(</span><a title="String" id="18176">requestPath</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="String">String</span> = <span class="delimiter">{</span>
    <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#18176" title="String">requestPath</a>.<span title="(x$1: java.lang.String)Boolean">startsWith</span><span class="delimiter">(</span><a href="#18174" title="String">staticPath</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#18176" title="String">requestPath</a>.<span title="(x$1: Int)java.lang.String">substring</span><span class="delimiter">(</span><a href="#18174" title="String">staticPath</a>.<span title="(x$1: Int)Int">length</span> + <span title="Int(1)" class="int">1</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#18176" title="String">requestPath</a>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(relativePath: String)java.lang.String" id="18170">buildPath</a><span class="delimiter">(</span><a title="String" id="18467">relativePath</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#18174" title="(x$1: Any)java.lang.String">staticPath</a> <span title="(x$1: Any)java.lang.String">+</span> <span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span> + <a href="#18467" title="String">relativePath</a>

  <span class="keyword">def</span> <a title="(exchange: com.sun.net.httpserver.HttpExchange)Unit" id="18171">handle</a><span class="delimiter">(</span><a title="com.sun.net.httpserver.HttpExchange" id="18472">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.lang.String" id="18474">requestPath</a> = <a href="#18472" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()java.net.URI">getRequestURI</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()java.lang.String">getPath</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="String" id="18475">relativePath</a> = <a href="#18169" title="(requestPath: String)String">getRelativePath</a><span class="delimiter">(</span><a href="#18474" title="java.lang.String">requestPath</a><span class="delimiter">)</span>

    <span class="keyword">val</span> <a title="java.lang.String" id="18476">contentType</a> = <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#18475" title="String">relativePath</a>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.js&quot;)" class="string">&quot;.js&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="java.lang.String(&quot;text/javascript&quot;)" class="string">&quot;text/javascript&quot;</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#18475" title="String">relativePath</a>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.html&quot;)" class="string">&quot;.html&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="java.lang.String(&quot;text/html&quot;)" class="string">&quot;text/html&quot;</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#18475" title="String">relativePath</a>.<span title="(x$1: java.lang.String)Boolean">endsWith</span><span class="delimiter">(</span><span title="java.lang.String(&quot;.css&quot;)" class="string">&quot;.css&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span title="java.lang.String(&quot;text/css&quot;)" class="string">&quot;text/css&quot;</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span title="java.lang.String(&quot;application/unknown&quot;)" class="string">&quot;application/unknown&quot;</span>
    <span class="delimiter">}</span>

    <a href="#11219" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange,code: Int,contentType: String)Unit">render</a><span class="delimiter">(</span><a href="#11220" title="(name: String)String">loadResource</a><span class="delimiter">(</span><a href="#18170" title="(relativePath: String)java.lang.String">buildPath</a><span class="delimiter">(</span><a href="#18475" title="String">relativePath</a><span class="delimiter">)</span><span class="delimiter">)</span>, <a href="#18472" title="com.sun.net.httpserver.HttpExchange">exchange</a>, <span title="Int(200)" class="int">200</span>, <a href="#18476" title="java.lang.String">contentType</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">object</span> <a title="object com.twitter.ostrich.admin.CgiRequestHandler" id="9198">CgiRequestHandler</a> <span title="ScalaObject" class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(exchange: com.sun.net.httpserver.HttpExchange)List[(String, String)]" id="18616">exchangeToParameters</a><span class="delimiter">(</span><a title="com.sun.net.httpserver.HttpExchange" id="18626">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span><span class="delimiter">)</span>: <span title="List[(String, String)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span> =
    <span title="(x: java.net.URI)Option[java.net.URI]">Option</span><span class="delimiter">(</span><a href="#18626" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()java.net.URI">getRequestURI</span><span class="delimiter">)</span> <span title="List[(String, String)]" class="keyword">match</span> <span class="delimiter">{</span>
      <span title="List[(String, String)]" class="keyword">case</span> Some<span class="delimiter">(</span><a title="java.net.URI" id="18822">uri</a><span class="delimiter">)</span> =&gt; <a href="#18617" title="(uri: java.net.URI)List[(String, String)]">uriToParameters</a><span class="delimiter">(</span><a href="#18822" title="java.net.URI">uri</a><span class="delimiter">)</span>
      <span title="scala.collection.immutable.Nil.type" class="keyword">case</span> <span title="object None">None</span>      =&gt; <span title="object Nil">Nil</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(uri: java.net.URI)List[(String, String)]" id="18617">uriToParameters</a><span class="delimiter">(</span><a title="java.net.URI" id="18824">uri</a>: <span title="java.net.URI">URI</span><span class="delimiter">)</span>: <span title="List[(String, String)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span title="(x: java.lang.String)Option[java.lang.String]">Option</span><span class="delimiter">(</span><a href="#18824" title="java.net.URI">uri</a>.<span title="()java.lang.String">getQuery</span><span class="delimiter">)</span>.<span title="(default: =&gt; java.lang.String)java.lang.String">getOrElse</span><span class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>.<span title="(x$1: java.lang.String)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;&amp;&quot;)" class="string">&quot;&amp;&quot;</span><span class="delimiter">)</span>.<span title="=&gt; List[java.lang.String]">toList</span>.<span title="(p: (java.lang.String) =&gt; Boolean)List[java.lang.String]">filter</span> <span class="delimiter">{</span> <a href="#19203" title="java.lang.String">_</a>.<span title="(x$1: java.lang.CharSequence)Boolean">contains</span><span class="delimiter">(</span><span title="java.lang.String(&quot;=&quot;)" class="string">&quot;=&quot;</span><span class="delimiter">)</span> <span class="delimiter">}</span>.<span title="(f: (java.lang.String) =&gt; (java.lang.String, java.lang.String))(implicit bf: scala.collection.generic.CanBuildFrom[List[java.lang.String],(java.lang.String, java.lang.String),List[(String, String)]])List[(String, String)]">map</span> <span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,(java.lang.String, java.lang.String),List[(java.lang.String, java.lang.String)]]" class="delimiter">{</span> <a title="java.lang.String" id="19245">param</a> =&gt;
      <a href="#19245" title="java.lang.String">param</a>.<span title="(x$1: java.lang.String,x$2: Int)Array[java.lang.String]">split</span><span title="(xs: Array[java.lang.String])scala.collection.mutable.ArrayOps[java.lang.String]" class="delimiter">(</span><span title="java.lang.String(&quot;=&quot;)" class="string">&quot;=&quot;</span>, <span title="Int(2)" class="int">2</span><span class="delimiter">)</span>.<span title="=&gt; List[java.lang.String]">toList</span> <span title="(java.lang.String, java.lang.String)" class="keyword">match</span> <span class="delimiter">{</span>
        <span title="(java.lang.String, java.lang.String)" class="keyword">case</span> <a title="java.lang.String" id="19464">k</a> :: <a title="java.lang.String" id="19481">v</a> :: <span title="object Nil">Nil</span> =&gt; <span title="(_1: java.lang.String,_2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><a href="#19464" title="java.lang.String">k</a>, <a href="#19481" title="java.lang.String">v</a><span class="delimiter">)</span>
        <span title="(java.lang.String, java.lang.String)" class="keyword">case</span> <a title="java.lang.String" id="19495">k</a> :: <span title="object Nil">Nil</span> =&gt; <span title="(_1: java.lang.String,_2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><a href="#19495" title="java.lang.String">k</a>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span>
        <span title="(java.lang.String, java.lang.String)" class="keyword">case</span> _ =&gt; <span title="(_1: java.lang.String,_2: java.lang.String)(java.lang.String, java.lang.String)" class="delimiter">(</span><span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span><span class="delimiter">)</span> <span class="comment">// won't happen, but stops the compiler from whining.</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class CgiRequestHandler extends com.twitter.ostrich.admin.CustomHttpHandler with ScalaObject" id="9200">CgiRequestHandler</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9194" title="com.twitter.ostrich.admin.CustomHttpHandler">CustomHttpHandler</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#9198" title="object com.twitter.ostrich.admin.CgiRequestHandler">CgiRequestHandler</a>._

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="com.twitter.logging.Logger" id="18620">log</a> = <span title="(name: String)com.twitter.logging.Logger">Logger</span><span class="delimiter">(</span><a href="#9200" title="()java.lang.Class[_]">getClass</a>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(exchange: com.sun.net.httpserver.HttpExchange)Unit" id="18622">handle</a><span class="delimiter">(</span><a title="com.sun.net.httpserver.HttpExchange" id="19616">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.net.URI" id="19618">requestURI</a> = <a href="#19616" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()java.net.URI">getRequestURI</span>
      <span class="keyword">val</span> <a title="List[String]" id="19619">path</a>       = <a href="#19618" title="java.net.URI">requestURI</a>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">getPath</span>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char('/')" class="char">'/'</span><span class="delimiter">)</span>.<span title="=&gt; List[String]">toList</span>.<span title="(p: (String) =&gt; Boolean)List[String]">filter</span> <span class="delimiter">{</span> <a href="#20401" title="String">_</a>.<span title="(x$1: Int)Boolean">length</span> &gt; <span title="Int(0)" class="int">0</span> <span class="delimiter">}</span>
      <span class="keyword">val</span> <a title="List[(String, String)]" id="19620">parameters</a> = <a href="#18616" title="(exchange: com.sun.net.httpserver.HttpExchange)List[(String, String)]">exchangeToParameters</a><span class="delimiter">(</span><a href="#19616" title="com.sun.net.httpserver.HttpExchange">exchange</a><span class="delimiter">)</span>

      <a href="#18623" title="(exchange: com.sun.net.httpserver.HttpExchange,path: List[String],parameters: List[(String, String)])Unit">handle</a><span class="delimiter">(</span><a href="#19616" title="com.sun.net.httpserver.HttpExchange">exchange</a>, <a href="#19619" title="List[String]">path</a>, <a href="#19620" title="List[(String, String)]">parameters</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">case</span> <a title="java.lang.Throwable" id="20546">e</a> =&gt;
        <a href="#11218" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange,code: Int)Unit">render</a><span class="delimiter">(</span><span title="(x$1: Any)java.lang.String" class="string">&quot;exception while processing request: &quot;</span> + <a href="#20546" title="java.lang.Throwable">e</a>, <a href="#19616" title="com.sun.net.httpserver.HttpExchange">exchange</a>, <span title="Int(500)" class="int">500</span><span class="delimiter">)</span>
        <a href="#18620" title="=&gt; com.twitter.logging.Logger">log</a>.<span title="(thrown: Throwable,msg: String,items: Any*)Unit">error</span><span class="delimiter">(</span><a href="#20546" title="java.lang.Throwable">e</a>, <span title="java.lang.String(&quot;Exception processing admin http request&quot;)" class="string">&quot;Exception processing admin http request&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(exchange: com.sun.net.httpserver.HttpExchange,path: List[String],parameters: List[(String, String)])Unit" id="18623">handle</a><span class="delimiter">(</span><a title="com.sun.net.httpserver.HttpExchange" id="20410">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span>, <a title="List[String]" id="20411">path</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[(String, String)]" id="20412">parameters</a>: <span title="List[(String, String)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class HeapResourceHandler extends com.twitter.ostrich.admin.CgiRequestHandler with ScalaObject" id="9201">HeapResourceHandler</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#9200" title="com.twitter.ostrich.admin.CgiRequestHandler">CgiRequestHandler</a> <span class="delimiter">{</span>
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="com.twitter.logging.Logger" id="20559">log</a> = <span title="(name: String)com.twitter.logging.Logger">Logger</span><span class="delimiter">(</span><a href="#9201" title="()java.lang.Class[_]">getClass</a>.<span title="()java.lang.String">getName</span><span class="delimiter">)</span>
  case <span class="keyword">class</span> <a title="class Params extends java.lang.Object with ScalaObject with Product" id="21743">Params</a><span title="ScalaObject" class="delimiter">(</span><a title="=&gt; com.twitter.util.Duration" id="20929">pause</a>: <span title="com.twitter.util.Duration">Duration</span>, <a title="=&gt; Int" id="20930">samplingPeriod</a>: <span title="Int">Int</span>, <a title="=&gt; Boolean" id="20931">forceGC</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(exchange: com.sun.net.httpserver.HttpExchange,path: List[String],parameters: List[(String, String)])Unit" id="20564">handle</a><span class="delimiter">(</span><a title="com.sun.net.httpserver.HttpExchange" id="20870">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span>, <a title="List[String]" id="20871">path</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[(String, String)]" id="20872">parameters</a>: <span title="List[(String, String)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="Heapster.scala.html#9236" title="object com.twitter.ostrich.admin.Heapster">Heapster</a>.<a href="Heapster.scala.html#20880" title="=&gt; Option[com.twitter.ostrich.admin.Heapster]">instance</a>.<span title="=&gt; Boolean">isDefined</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#11217" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange)Unit">render</a><span class="delimiter">(</span><span title="java.lang.String(&quot;heapster not loaded!&quot;)" class="string">&quot;heapster not loaded!&quot;</span>, <a href="#20870" title="com.sun.net.httpserver.HttpExchange">exchange</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="com.twitter.ostrich.admin.Heapster" id="20875">heapster</a> = <a href="Heapster.scala.html#9236" title="object com.twitter.ostrich.admin.Heapster">Heapster</a>.<a href="Heapster.scala.html#20880" title="=&gt; Option[com.twitter.ostrich.admin.Heapster]">instance</a>.<span title="=&gt; com.twitter.ostrich.admin.Heapster">get</span>

    <span class="keyword">val</span> <a title="HeapResourceHandler.this.Params" id="20876">params</a> =
      <a href="#20872" title="List[(String, String)]">parameters</a>.<span title="(z: HeapResourceHandler.this.Params)(f: (HeapResourceHandler.this.Params, (String, String)) =&gt; HeapResourceHandler.this.Params)HeapResourceHandler.this.Params">foldLeft</span><span class="delimiter">(</span><a href="#21743" title="(pause: com.twitter.util.Duration,samplingPeriod: Int,forceGC: Boolean)HeapResourceHandler.this.Params">Params</a><span class="delimiter">(</span><span title="implicit com.twitter.conversions.time.intToTimeableNumber : (i: Int)com.twitter.conversions.time.RichWholeNumber" class="int">10</span>.<span title="=&gt; com.twitter.util.Duration">seconds</span>, <span class="int">10</span> <span title="Int(5242880)">&lt;&lt;</span> <span class="int">19</span>, <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#20963" title="HeapResourceHandler.this.Params" class="delimiter">{</a>
        <span title="HeapResourceHandler.this.Params" class="keyword">case</span> <span class="delimiter">(</span><a title="HeapResourceHandler.this.Params" id="20974">params</a>, <span class="delimiter">(</span><span title="java.lang.String(&quot;pause&quot;)" class="string">&quot;pause&quot;</span>, <a title="String" id="20977">pauseVal</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
          <a href="#20974" title="HeapResourceHandler.this.Params">params</a>.<a href="#21743" title="(pause: com.twitter.util.Duration,samplingPeriod: Int,forceGC: Boolean)HeapResourceHandler.this.Params">copy</a><span class="delimiter">(</span>pause = <a href="#20977" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">pauseVal</a>.<span title="implicit com.twitter.conversions.time.intToTimeableNumber : (i: Int)com.twitter.conversions.time.RichWholeNumber">toInt</span>.<span title="=&gt; com.twitter.util.Duration">seconds</span><span class="delimiter">)</span>
        <span title="HeapResourceHandler.this.Params" class="keyword">case</span> <span class="delimiter">(</span><a title="HeapResourceHandler.this.Params" id="21018">params</a>, <span class="delimiter">(</span><span title="java.lang.String(&quot;sample_period&quot;)" class="string">&quot;sample_period&quot;</span>, <a title="String" id="21021">sampleVal</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
          <a href="#21018" title="HeapResourceHandler.this.Params">params</a>.<a href="#20929" title="com.twitter.util.Duration" id="21042">copy</a><span class="delimiter">(</span>samplingPeriod = <a href="#21021" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">sampleVal</a>.<a title="Int" id="21040">toInt</a><span class="delimiter">)</span>
        <span title="HeapResourceHandler.this.Params" class="keyword">case</span> <span class="delimiter">(</span><a title="HeapResourceHandler.this.Params" id="21046">params</a>, <span class="delimiter">(</span><span title="java.lang.String(&quot;force_gc&quot;)" class="string">&quot;force_gc&quot;</span>, <span title="java.lang.String(&quot;no&quot;)" class="string">&quot;no&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
          <a href="#21046" title="HeapResourceHandler.this.Params">params</a>.<a href="#20929" title="com.twitter.util.Duration" id="21054">copy</a><span class="delimiter">(</span>forceGC = <a title="Boolean(false)" id="21052" class="keyword">false</a><span class="delimiter">)</span>
        <span title="HeapResourceHandler.this.Params" class="keyword">case</span> <span class="delimiter">(</span><a title="HeapResourceHandler.this.Params" id="21058">params</a>, <span class="delimiter">(</span><span title="java.lang.String(&quot;force_gc&quot;)" class="string">&quot;force_gc&quot;</span>, <span title="java.lang.String(&quot;0&quot;)" class="string">&quot;0&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span> =&gt;
          <a href="#21058" title="HeapResourceHandler.this.Params">params</a>.<a href="#20929" title="com.twitter.util.Duration" id="21066">copy</a><span class="delimiter">(</span>forceGC = <a title="Boolean(false)" id="21064" class="keyword">false</a><span class="delimiter">)</span>
        <span title="HeapResourceHandler.this.Params" class="keyword">case</span> <span class="delimiter">(</span><a title="HeapResourceHandler.this.Params" id="21070">params</a>, _<span class="delimiter">)</span> =&gt;
          <a href="#21070" title="HeapResourceHandler.this.Params">params</a>
      <span class="delimiter">}</span>

    <a href="#20559" title="=&gt; com.twitter.logging.Logger">log</a>.<span title="(msg: String,items: Any*)Unit">info</span><span class="delimiter">(</span><span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;collecting heap profile for %s seconds&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#20876" title="HeapResourceHandler.this.Params">params</a>.<a href="#20929" title="=&gt; com.twitter.util.Duration">pause</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Array[Byte]" id="20877">profile</a> = <a href="#20875" title="com.twitter.ostrich.admin.Heapster">heapster</a>.<a href="Heapster.scala.html#20909" title="(howlong: com.twitter.util.Duration,samplingPeriod: Int,forceGC: Boolean)Array[Byte]">profile</a><span class="delimiter">(</span><a href="#20876" title="HeapResourceHandler.this.Params">params</a>.<a href="#20929" title="=&gt; com.twitter.util.Duration">pause</a>, <a href="#20876" title="HeapResourceHandler.this.Params">params</a>.<a href="#20930" title="=&gt; Int">samplingPeriod</a>, <a href="#20876" title="HeapResourceHandler.this.Params">params</a>.<a href="#20931" title="=&gt; Boolean">forceGC</a><span class="delimiter">)</span>

    <span class="comment">// Write out the profile verbatim. It's a pprof &quot;raw&quot; profile.</span>
    <a href="#20870" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()com.sun.net.httpserver.Headers">getResponseHeaders</span>.<span title="(x$1: java.lang.String,x$2: java.lang.String)Unit">set</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Content-Type&quot;)" class="string">&quot;Content-Type&quot;</span>, <span title="java.lang.String(&quot;pprof/raw&quot;)" class="string">&quot;pprof/raw&quot;</span><span class="delimiter">)</span>
    <a href="#20870" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="(x$1: Int,x$2: Long)Unit">sendResponseHeaders</span><span class="delimiter">(</span><span title="Int(200)" class="int">200</span>, <a href="#20877" title="implicit scala.Predef.byteArrayOps : (xs: Array[Byte])scala.collection.mutable.ArrayOps[Byte]">profile</a>.<span title="=&gt; Long">size</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.OutputStream" id="20878">output</a>: <span title="java.io.OutputStream">OutputStream</span> = <a href="#20870" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()java.io.OutputStream">getResponseBody</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#20878" title="java.io.OutputStream">output</a>.<span title="(x$1: Array[Byte])Unit">write</span><span class="delimiter">(</span><a href="#20877" title="Array[Byte]">profile</a><span class="delimiter">)</span>
    <a href="#20878" title="java.io.OutputStream">output</a>.<span title="()Unit">flush</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#20878" title="java.io.OutputStream">output</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#20870" title="com.sun.net.httpserver.HttpExchange">exchange</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class CommandRequestHandler extends com.twitter.ostrich.admin.CgiRequestHandler with ScalaObject" id="9202">CommandRequestHandler</a><span title="ScalaObject" class="delimiter">(</span><a title="com.twitter.ostrich.admin.CommandHandler" id="21760">commandHandler</a>: <a href="CommandHandler.scala.html#9230" title="com.twitter.ostrich.admin.CommandHandler">CommandHandler</a><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="#9200" title="com.twitter.ostrich.admin.CgiRequestHandler">CgiRequestHandler</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(exchange: com.sun.net.httpserver.HttpExchange,path: List[String],parameters: List[(String, String)])Unit" id="21747">handle</a><span class="delimiter">(</span><a title="com.sun.net.httpserver.HttpExchange" id="21762">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span>, <a title="List[String]" id="21763">path</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="List[(String, String)]" id="21764">parameters</a>: <span title="List[(String, String)]">List</span><span class="delimiter">[</span><span class="delimiter">(</span>String, String<span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#21763" title="(x$1: AnyRef)Boolean">path</a> == <span title="object Nil">Nil</span><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#11217" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange)Unit">render</a><span class="delimiter">(</span><a href="#11220" title="(name: String)String">loadResource</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/static/index.html&quot;)" class="string">&quot;/static/index.html&quot;</span><span class="delimiter">)</span>, <a href="#21762" title="com.sun.net.httpserver.HttpExchange">exchange</a><span class="delimiter">)</span>
      <span title="Nothing" class="keyword">return</span>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="String" id="21767">command</a> = <a href="#21763" title="List[String]">path</a>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">last</span>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char('.')" class="char">'.'</span><span class="delimiter">)</span>.<span title="=&gt; String">head</span>
    <span class="keyword">val</span> <a title="com.twitter.ostrich.admin.Format" id="21768">format</a>: <a href="CommandHandler.scala.html#9227" title="com.twitter.ostrich.admin.Format">Format</a> = <a href="#21763" title="List[String]">path</a>.<span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">last</span>.<span title="(separator: Char)Array[String]">split</span><span title="(xs: Array[String])scala.collection.mutable.ArrayOps[String]" class="delimiter">(</span><span title="Char('.')" class="char">'.'</span><span class="delimiter">)</span>.<span title="=&gt; String">last</span> <span title="com.twitter.ostrich.admin.Format" class="keyword">match</span> <span class="delimiter">{</span>
      <span title="com.twitter.ostrich.admin.Format.PlainText.type" class="keyword">case</span> <span title="java.lang.String(&quot;txt&quot;)" class="string">&quot;txt&quot;</span> =&gt; <a href="CommandHandler.scala.html#9228" title="object com.twitter.ostrich.admin.Format">Format</a>.<a href="CommandHandler.scala.html#22398" title="object com.twitter.ostrich.admin.Format.PlainText">PlainText</a>
      <span title="com.twitter.ostrich.admin.Format.Json.type" class="keyword">case</span> _ =&gt; <a href="CommandHandler.scala.html#9228" title="object com.twitter.ostrich.admin.Format">Format</a>.<a href="CommandHandler.scala.html#22400" title="object com.twitter.ostrich.admin.Format.Json">Json</a>
    <span class="delimiter">}</span>

    <span class="keyword">val</span> <a title="scala.collection.immutable.Map[String,String]" id="21769">parameterMap</a> = <span title="(elems: (String, String)*)scala.collection.immutable.Map[String,String]">Map</span><span class="delimiter">(</span><a href="#21764" title="List[(String, String)]">parameters</a>: _*<span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="String" id="22639">response</a> = <span class="delimiter">{</span>
        <span class="keyword">val</span> <a title="String" id="22641">commandResponse</a> = <a href="CommandHandler.scala.html#21757" title="(command: String,parameters: scala.collection.Map[String,String],format: com.twitter.ostrich.admin.Format)String">commandHandler</a><span class="delimiter">(</span><a href="#21767" title="String">command</a>, <a href="#21769" title="scala.collection.immutable.Map[String,String]">parameterMap</a>, <a href="#21768" title="com.twitter.ostrich.admin.Format">format</a><span class="delimiter">)</span>

        <span title="String" class="keyword">if</span> <span class="delimiter">(</span><a href="#21769" title="scala.collection.immutable.Map[String,String]">parameterMap</a>.<span title="=&gt; scala.collection.Set[String]">keySet</span>.<span title="(elem: String)Boolean">contains</span><span title="(x$1: Boolean)Boolean" class="delimiter">(</span><span title="java.lang.String(&quot;callback&quot;)" class="string">&quot;callback&quot;</span><span class="delimiter">)</span> &amp;&amp; <span class="delimiter">(</span><a href="#21768" title="(x$1: AnyRef)Boolean">format</a> == <a href="CommandHandler.scala.html#9228" title="object com.twitter.ostrich.admin.Format">Format</a>.<a href="CommandHandler.scala.html#22400" title="object com.twitter.ostrich.admin.Format.Json">Json</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps" class="string">&quot;ostrichCallback(%s)&quot;</span>.<span title="(args: Any*)String">format</span><span class="delimiter">(</span><a href="#22641" title="String">commandResponse</a><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <a href="#22641" title="String">commandResponse</a>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>

      <span class="keyword">val</span> <a title="java.lang.String" id="22640">contentType</a> = <span title="java.lang.String" class="keyword">if</span> <span class="delimiter">(</span><a href="#21768" title="(x$1: AnyRef)Boolean">format</a> == <a href="CommandHandler.scala.html#9228" title="object com.twitter.ostrich.admin.Format">Format</a>.<a href="CommandHandler.scala.html#22398" title="object com.twitter.ostrich.admin.Format.PlainText">PlainText</a><span class="delimiter">)</span> <span title="java.lang.String(&quot;text/plain&quot;)" class="string">&quot;text/plain&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;application/json&quot;)" class="string">&quot;application/json&quot;</span>
      <a href="#11219" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange,code: Int,contentType: String)Unit">render</a><span class="delimiter">(</span><a href="#22639" title="String">response</a>, <a href="#21762" title="com.sun.net.httpserver.HttpExchange">exchange</a>, <span title="Int(200)" class="int">200</span>, <a href="#22640" title="java.lang.String">contentType</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span title="Unit" class="keyword">case</span> <a title="com.twitter.ostrich.admin.UnknownCommandError" id="22915">e</a>: <a href="CommandHandler.scala.html#9226" title="com.twitter.ostrich.admin.UnknownCommandError">UnknownCommandError</a> =&gt;
        <a href="#11218" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange,code: Int)Unit">render</a><span class="delimiter">(</span><span title="java.lang.String(&quot;no such command&quot;)" class="string">&quot;no such command&quot;</span>, <a href="#21762" title="com.sun.net.httpserver.HttpExchange">exchange</a>, <span title="Int(404)" class="int">404</span><span class="delimiter">)</span>
      <span title="Unit" class="keyword">case</span> <a title="java.lang.Throwable" id="22932">unknownException</a> =&gt;
        <a href="#11218" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange,code: Int)Unit">render</a><span class="delimiter">(</span><span title="(x$1: Any)java.lang.String" class="string">&quot;error processing command: &quot;</span> + <a href="#22932" title="java.lang.Throwable">unknownException</a>, <a href="#21762" title="com.sun.net.httpserver.HttpExchange">exchange</a>, <span title="Int(500)" class="int">500</span><span class="delimiter">)</span>
        <a href="#22932" title="java.lang.Throwable">unknownException</a>.<span title="()Unit">printStackTrace</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span class="keyword">class</span> <a title="class AdminHttpService extends java.lang.Object with com.twitter.ostrich.admin.Service with ScalaObject" id="9203">AdminHttpService</a><span title="ScalaObject" class="delimiter">(</span>
  <a title="Int" id="24077">port</a>: <span title="Int">Int</span>, <a title="Int" id="24078">backlog</a>: <span title="Int">Int</span>, <a title="com.twitter.ostrich.stats.StatsCollection" id="24079">statsCollection</a>: <a href="StatsCollection.scala.html#9357" title="com.twitter.ostrich.stats.StatsCollection">StatsCollection</a>, <a title="com.twitter.ostrich.admin.RuntimeEnvironment" id="24080">runtime</a>: <a href="RuntimeEnvironment.scala.html#9249" title="com.twitter.ostrich.admin.RuntimeEnvironment">RuntimeEnvironment</a>
<span class="delimiter">)</span> <span class="keyword">extends</span> <a href="Service.scala.html#9253" title="com.twitter.ostrich.admin.Service">Service</a> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(port: Int,backlog: Int,runtime: com.twitter.ostrich.admin.RuntimeEnvironment)com.twitter.ostrich.admin.AdminHttpService" id="23239" class="keyword">this</a><span class="delimiter">(</span><a title="Int" id="24085">port</a>: <span title="Int">Int</span>, <a title="Int" id="24086">backlog</a>: <span title="Int">Int</span>, <a title="com.twitter.ostrich.admin.RuntimeEnvironment" id="24087">runtime</a>: <a href="RuntimeEnvironment.scala.html#9249" title="com.twitter.ostrich.admin.RuntimeEnvironment">RuntimeEnvironment</a><span class="delimiter">)</span> =
    <a href="#9203" title="AdminHttpService.this.type" class="keyword">this</a><span class="delimiter">(</span><a href="#24085" title="Int">port</a>, <a href="#24086" title="Int">backlog</a>, <a href="Stats.scala.html#9346" title="object com.twitter.ostrich.stats.Stats">Stats</a>, <a href="#24087" title="com.twitter.ostrich.admin.RuntimeEnvironment">runtime</a><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="com.twitter.logging.Logger" id="23240">log</a> = <span title="(cls: Class[_])com.twitter.logging.Logger">Logger</span><span class="delimiter">(</span><a href="#9203" title="()java.lang.Class[_]">getClass</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="com.sun.net.httpserver.HttpServer" id="23242">httpServer</a>: <span title="com.sun.net.httpserver.HttpServer">HttpServer</span> = <span title="object com.sun.net.httpserver.HttpServer">HttpServer</span>.<span title="(x$1: java.net.InetSocketAddress,x$2: Int)com.sun.net.httpserver.HttpServer">create</span><span class="delimiter">(</span><span title="java.net.InetSocketAddress" class="keyword">new</span> <span title="java.net.InetSocketAddress">InetSocketAddress</span><span class="delimiter">(</span><a href="#24077" title="Int">port</a><span class="delimiter">)</span>, <a href="#24078" title="Int">backlog</a><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="com.twitter.ostrich.admin.CommandHandler" id="23244">commandHandler</a> = <span title="com.twitter.ostrich.admin.CommandHandler" class="keyword">new</span> <a href="CommandHandler.scala.html#9230" title="com.twitter.ostrich.admin.CommandHandler">CommandHandler</a><span class="delimiter">(</span><a href="#24080" title="com.twitter.ostrich.admin.RuntimeEnvironment">runtime</a>, <a href="#24079" title="com.twitter.ostrich.stats.StatsCollection">statsCollection</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="=&gt; java.net.InetSocketAddress" id="23246">address</a> = <a href="#23242" title="=&gt; com.sun.net.httpserver.HttpServer">httpServer</a>.<span title="()java.net.InetSocketAddress">getAddress</span>

  <a href="#23247" title="(path: String,handler: com.sun.net.httpserver.HttpHandler)com.sun.net.httpserver.HttpContext">addContext</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>, <span title="com.twitter.ostrich.admin.CommandRequestHandler" class="keyword">new</span> <a href="#9202" title="com.twitter.ostrich.admin.CommandRequestHandler">CommandRequestHandler</a><span class="delimiter">(</span><a href="#23244" title="=&gt; com.twitter.ostrich.admin.CommandHandler">commandHandler</a><span class="delimiter">)</span><span class="delimiter">)</span>
  <a href="#23247" title="(path: String,handler: com.sun.net.httpserver.HttpHandler)com.sun.net.httpserver.HttpContext">addContext</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/report/&quot;)" class="string">&quot;/report/&quot;</span>, <span title="com.twitter.ostrich.admin.PageResourceHandler" class="keyword">new</span> <a href="#9196" title="com.twitter.ostrich.admin.PageResourceHandler">PageResourceHandler</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/report_request_handler.html&quot;)" class="string">&quot;/report_request_handler.html&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <a href="#23247" title="(path: String,handler: com.sun.net.httpserver.HttpHandler)com.sun.net.httpserver.HttpContext">addContext</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/favicon.ico&quot;)" class="string">&quot;/favicon.ico&quot;</span>, <span title="com.twitter.ostrich.admin.MissingFileHandler" class="keyword">new</span> <a href="#9195" title="com.twitter.ostrich.admin.MissingFileHandler">MissingFileHandler</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <a href="#23247" title="(path: String,handler: com.sun.net.httpserver.HttpHandler)com.sun.net.httpserver.HttpContext">addContext</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/static&quot;)" class="string">&quot;/static&quot;</span>, <span title="com.twitter.ostrich.admin.FolderResourceHandler" class="keyword">new</span> <a href="#9197" title="com.twitter.ostrich.admin.FolderResourceHandler">FolderResourceHandler</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/static&quot;)" class="string">&quot;/static&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
  <a href="#23247" title="(path: String,handler: com.sun.net.httpserver.HttpHandler)com.sun.net.httpserver.HttpContext">addContext</a><span class="delimiter">(</span><span title="java.lang.String(&quot;/pprof/heap&quot;)" class="string">&quot;/pprof/heap&quot;</span>, <span title="com.twitter.ostrich.admin.HeapResourceHandler" class="keyword">new</span> <a href="#9201" title="com.twitter.ostrich.admin.HeapResourceHandler">HeapResourceHandler</a><span class="delimiter">)</span>

  <a href="#23242" title="=&gt; com.sun.net.httpserver.HttpServer">httpServer</a>.<span title="(x$1: java.util.concurrent.Executor)Unit">setExecutor</span><span class="delimiter">(</span><span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(path: String,handler: com.sun.net.httpserver.HttpHandler)com.sun.net.httpserver.HttpContext" id="23247">addContext</a><span class="delimiter">(</span><a title="String" id="24357">path</a>: <span title="String">String</span>, <a title="com.sun.net.httpserver.HttpHandler" id="24358">handler</a>: <span title="com.sun.net.httpserver.HttpHandler">HttpHandler</span><span class="delimiter">)</span> = <a href="#23242" title="=&gt; com.sun.net.httpserver.HttpServer">httpServer</a>.<span title="(x$1: java.lang.String,x$2: com.sun.net.httpserver.HttpHandler)com.sun.net.httpserver.HttpContext">createContext</span><span class="delimiter">(</span><a href="#24357" title="String">path</a>, <a href="#24358" title="com.sun.net.httpserver.HttpHandler">handler</a><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(path: String)(generator: () =&gt; String)com.sun.net.httpserver.HttpContext" id="23248">addContext</a><span class="delimiter">(</span><a title="String" id="24312">path</a>: <span title="String">String</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="() =&gt; String" id="24313">generator</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; String<span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="com.twitter.ostrich.admin.CustomHttpHandler" id="24316">handler</a> = <a href="#24317" title="com.twitter.ostrich.admin.CustomHttpHandler" class="keyword">new</a> <a href="#9194" title="anonymous class $anon extends com.twitter.ostrich.admin.CustomHttpHandler" id="24317">CustomHttpHandler</a> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="(exchange: com.sun.net.httpserver.HttpExchange)Unit" id="24319">handle</a><span class="delimiter">(</span><a title="com.sun.net.httpserver.HttpExchange" id="24320">exchange</a>: <span title="com.sun.net.httpserver.HttpExchange">HttpExchange</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#11217" title="(body: String,exchange: com.sun.net.httpserver.HttpExchange)Unit">render</a><span class="delimiter">(</span><a href="#24313" title="()String">generator</a><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#24320" title="com.sun.net.httpserver.HttpExchange">exchange</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
    <a href="#23242" title="=&gt; com.sun.net.httpserver.HttpServer">httpServer</a>.<span title="(x$1: java.lang.String,x$2: com.sun.net.httpserver.HttpHandler)com.sun.net.httpserver.HttpContext">createContext</span><span class="delimiter">(</span><a href="#24312" title="String">path</a>, <a href="#24316" title="com.twitter.ostrich.admin.CustomHttpHandler">handler</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(socket: java.net.Socket)Unit" id="23249">handleRequest</a><span class="delimiter">(</span><a title="java.net.Socket" id="24389">socket</a>: <span title="java.net.Socket">Socket</span><span class="delimiter">)</span> <span title="Unit" class="delimiter">{</span> <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="23250">start</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">{</span>
    <a href="ServiceTracker.scala.html#9259" title="object com.twitter.ostrich.admin.ServiceTracker">ServiceTracker</a>.<a href="ServiceTracker.scala.html#24622" title="(service: com.twitter.ostrich.admin.Service)Unit">register</a><span class="delimiter">(</span><a href="#9203" title="com.twitter.ostrich.admin.AdminHttpService" class="keyword">this</a><span class="delimiter">)</span>
    <a href="#23242" title="=&gt; com.sun.net.httpserver.HttpServer">httpServer</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#23240" title="=&gt; com.twitter.logging.Logger">log</a>.<span title="(msg: String,items: Any*)Unit">info</span><span class="delimiter">(</span><span title="java.lang.String(&quot;Admin HTTP interface started on port %d.&quot;)" class="string">&quot;Admin HTTP interface started on port %d.&quot;</span>, <a href="#23246" title="=&gt; java.net.InetSocketAddress">address</a>.<span title="()Int">getPort</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="23251">shutdown</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#23242" title="=&gt; com.sun.net.httpserver.HttpServer">httpServer</a>.<span title="(x$1: Int)Unit">stop</span><span class="delimiter">(</span><span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <span class="comment">// argument is in seconds</span>

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="23252">quiesce</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#23242" title="=&gt; com.sun.net.httpserver.HttpServer">httpServer</a>.<span title="(x$1: Int)Unit">stop</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span> <span class="comment">// argument is in seconds</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>